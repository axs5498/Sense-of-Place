---
title: "SEM_Exercise"
author: "Ashok Sekar"
date: "08/11/2016"
output: pdf_document
fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(knitr)
require(xlsx)
require(sem)
require(DiagrammeR)
require(semPlot)
require(lavaan)

#use this chunk for making other global setting regarding figure size, figure captions etc. 
```

# Introduction 

This document is about testing and performing Structural equation modeling (SEM) with the Sense of Place (SOP) dataset. The SEM will relate SOP dimentions of a neighborhood with demographic variables and travel responses. 

To develop the model we first perform a confirmatory factor analysis. The factor analysis helps in identifying the sense of place (SOP) dimensions that exists in a neighborhood. For example, in the survey, several likert scale based questions that aimed at capturing the responder's attitude towards the place were asked. Those responses are used to identify 6 latent factors also called SOP dimensions. The hypothesis is that neighborhoods could have differing SOP dimensions. 

A factor analysis was performed, not described here, and the resulting factor strucutre forms the basis for this analysis. For simplicity, we look at the final factor structure for each neighborhood seperately. Factor structure for RPM is given in Figure 1. Based on the figure we know of the 6 dimensions dependence and identity does not explain the SOP of RPM. Using the factor struture we add on travel and demographic variables to identify the final structure. 

![Factor Structure for Rochester Public Market](FactorStructure_RPM.png)


##Datasets 
For this analysis we depend on a dataset named *mainFile*. The file contains both the attitudinal responses, travel and socio-demographic characteristics. Note that for factor analysis the attitudinal responses for dimensions were used. For SEM we would be using attitudinal responses, travel and socio-demographic variables. 

The *mainFile* was used to create two different files depending on how the missing values were treated. Numerous responses to likert scale questions contained a *NA* category, therefore we decided to convert the NA values to "4" being neutral. Note that NA means responders did not have any attitude towards that question. For the other file no changes were made. However, it is important to note that for our analysis we use the dataset that has NA values converted to 4. The code for the data preperation is not shown here. In addition all the categorical data were converted into binary variables. E.g., many demograhic variables such as age, income were collected as categories. They were converted to binary variables. 

```{r datasetprep, include=FALSE, echo=FALSE, eval=TRUE}

ds<-read.xlsx("C:/Users/DIV/Google Drive/Professional/Sense of Place/Data/Results/mainFile.xlsx",1)

# for the SOP dimension the NA values are converted to 4. 4 being neutral. the same exercise can be performed with missing values refer to Lavan tutorials

#between column 8 to 34 convert the NA to 4 and convert the columns to number 

workds<-ds
for (i in 8:34)
  {
  workds[,i]<-as.numeric(as.character(workds[,i]))
} 

#converting the values to 4. 
workds_NA4<-workds
workds_NA4[,8:34][is.na(workds_NA4[,8:34])]<-4
workds_NA<-workds #this is the dataset that contains NA values. 


#note to switch the indicators that are negative into posititive. e.g., bad area. 

```
```{r factsummary, echo=FALSE, fig.height=4, fig.width=7}

ColNamesRPM<-c("food","amn","ent","ppl","mopark","bipark","biwalk_access","trnst_access","happy","disapp","connect","arch","artistic","beau","friendly","family","atmos")

sat_RPM<-c("food","amn","ent","ppl","mopark","bipark","biwalk_access","trnst_access")
soc_RPM<-c("friendly","family","atmos")
aes_RPM<-c("arch","artistic","beau")
att_RPM<-c("happy","disapp","connect")
FacStr_RPM<-c(sat_RPM,soc_RPM,aes_RPM,att_RPM)


demog<-c("gender","age","no_hhmem","emp_ft","child","relationHHmem","inc","yearsinROC")

#creating seperate variable for each demographic characteristics 
gender<-model.matrix(~gender - 1,data = workds_NA4)
male<-gender[,3]
female<-gender[,2]
gender_DtoA<-gender[,1]

age<-model.matrix(~age-1,data = workds_NA4)
age_le25 <- age[,1]
age_25to35 <- age[,2]
age_35to45 <- age[,3]
age_45to54 <- age[,4]
age_55to64 <- age[,5]
age_65to75 <- age[,6]
age_ge75 <- age[,7]

no_hhmem<-model.matrix(~no_hhmem - 1, data = workds_NA4)
hhmem_1<-no_hhmem[,1]
hhmem_2<-no_hhmem[,2]
hhmem_3<-no_hhmem[,3]
hhmem_4<-no_hhmem[,4]
hhmem_5ormore<-no_hhmem[,5]
hhmem_DtoA<-no_hhmem[,6]

emp_ft<-model.matrix(~emp_ft - 1, data = workds_NA4)
emp_ft_0<-emp_ft[,1]
emp_ft_1<-emp_ft[,2]
emp_ft_2<-emp_ft[,3]
emp_ft_3<-emp_ft[,4]
emp_ft_4<-emp_ft[,5]
emp_ft_5ormore<-emp_ft[,6]
emp_ft_DtoA<-emp_ft[,7]

child<-model.matrix(~child - 1, data = workds_NA4)
child_0<-child[,1]
child_1<-child[,2]
child_2<-child[,3]
child_3<-child[,4]
child_4ormore<-child[,5]
child_DtoA<-child[,6]

rltnHHmem<-model.matrix(~relationHHmem - 1, data = workds_NA4)
rltnHHmem_alone<-rltnHHmem[,1]
rltnHHmem_friends<-rltnHHmem[,2]
rltnHHmem_family<-rltnHHmem[,3]
rltnHHmem_extfamily<-rltnHHmem[,4]
rltnHHmem_acquaintances<-rltnHHmem[,5]


inc<-model.matrix(~inc - 1, data = workds_NA4)
inc_le25k<-inc[,1]
inc_100kto125k<-inc[,2]
inc_125kto150k<-inc[,3]
inc_150kto175k<-inc[,4]
inc_175kto200k<-inc[,5]
inc_ge200k<-inc[,6]
inc_25kto50k<-inc[,7]
inc_50kto75k<-inc[,8]
inc_75kto100k<-inc[,9]
inc_DtoA<-inc[,10]


yearsinROC<-model.matrix(~yearsinROC - 1, data = workds_NA4)
years_1to5 <- yearsinROC[,1]
years_6to10 <- yearsinROC[,2]
years_DtoAyears<-yearsinROC[,3]
notfromRoc<-yearsinROC[,4]
years_le1<-yearsinROC[,5]
years_ge10<-yearsinROC[,6]




travel<-c("visit","mode","biwalk","alone","fam_imm","fam_ext","friend","colleague","students","mentor","org",
          "no_vehicle","no_drivers","no_bicycles")

#Creating variable for each travel characteristic 
visit<-model.matrix(~visit - 1, data = workds_NA4)
everyday<-visit[,1]
leonceamonth<-visit[,2]
onceamonth<-visit[,3]
onceaweek<-visit[,4]
onceinthreeweeks<-visit[,5]
onceintwoweeks<-visit[,6]
threeormoretimesaweek<-visit[,7]
twiceaweek<-visit[,8]


mode<-model.matrix(~mode - 1, data = workds_NA4)
bike<-mode[,1]
carpool<-mode[,2]
personalvehicle<-mode[,3]
publictransit<-mode[,4]
walk<-mode[,5]

biwalk<-model.matrix(~biwalk - 1, data = workds_NA4)
biwalk.none<-biwalk[,1]
biwalk.lemonth<-biwalk[,2]
biwalk.oncemonth<-biwalk[,3]
biwalk.onceweek<-biwalk[,4]
biwalk.oncein3weeks<-biwalk[,5]
biwalk.oncein2weeks<-biwalk[,6]
biwalk.threeormoreaweek<-biwalk[,7]
biwalk.twiceaweek<-biwalk[,8]


no_bicycles<-model.matrix(~no_bicycles - 1, data = workds_NA4)
bike_1<-no_bicycles[,1]
bike_2<-no_bicycles[,2]
bike_3<-no_bicycles[,3]
bike_4<-no_bicycles[,4]
bike_ge5<-no_bicycles[,5]


#alone<-ifelse(workds_NA4$alone=="None",1,0)
#alone<-ifelse(workds_NA4$alone=="NA",0,1)

```

#Experimental Model: 

This is my first experimental model using *SEM* package. I used SEM package because it seemed easy to set arrows with this package. This is followed by using Lavaan based *semPlot* package for visualizing the path diagram. In this simple model, a regression model is set up between number of vehicles in a household and the number of drivers with valid driver's license. The estimate is saved as the variable *pi* and the variance are recorded as *var1* and *var2*. Because we are using the *SEM* package the factor structure for RPM is again evaluated using *SEM* package. The same result was identified. To keep the document simple I have not added the results below.  

```{r sem_V1, include=FALSE, echo=TRUE, eval=TRUE,fig.cap="Strucytre of a Simple SEM",fig.height=2,fig.width=7}


workds_NA4$no_vehicle<-as.numeric(as.character(workds_NA4$no_vehicle))
workds_NA4$no_drivers<-as.numeric(as.character(workds_NA4$no_drivers))

model<-specifyModel(text = "
  no_vehicle -> no_drivers, pi, NA
  no_drivers<->no_drivers, var1, NA
  no_vehicle<->no_vehicle, var2, NA"
)

#fitting the model 
fit<-sem::sem(model,data=workds_NA4[,c("no_vehicle","no_drivers")]) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit,whatLabels = "est",rotation = 2)
summary(fit)

```

```{r factorverification, include=FALSE, echo=TRUE, eval=TRUE,fig.cap="Factor Structure of RPM for verification with Figure 1",fig.height=4,fig.width=7}


factormodel_RPM<-specifyModel(text = "
  sat -> food, NA, 1
  sat -> amn, pi2, NA
  sat -> ent, pi3, NA
  sat -> ppl, pi4, NA
  sat -> mopark, pi5, NA
  sat -> bipark, pi6, NA
  sat -> biwalk_access,pi7, NA
  sat -> trnst_access, pi8, NA
  sat <-> sat, var1, NA
  food <-> food, si1, NA
  amn <-> amn, si2, NA
  ent <-> ent, si3, NA
  ppl <-> ppl, si4, NA
  mopark <-> mopark, si5, NA
  bipark <-> bipark, si6, NA
  biwalk_access <-> biwalk_access, si7, NA 
  trnst_access <-> trnst_access, si8, NA

  soc -> friendly, pi9, NA
  soc -> family, pi10, NA
  soc -> atmos, NA, 1
  soc <-> soc, var2, NA
  friendly <-> friendly, si9, NA
  family <-> family, si10, NA
  atmos <-> atmos, si11, NA

  aes -> beau, NA, 1
  aes -> arch, pi11, NA
  aes -> artistic, p12, NA
  aes <-> aes, var3, NA
  beau <-> beau, si12, NA
  arch <-> arch, si13, NA
  artistic <-> artistic, si14, NA

  att -> connect, NA, 1
  att -> disapp, p13, NA
  att -> happy, p14, NA
  att <-> att, var4, NA
  connect <-> connect, si15, NA
  disapp <-> disapp, si16, NA
  happy <-> happy, si17, NA

  RPM -> sat, gam1, NA
  RPM -> soc, gam2, NA
  RPM -> aes, NA, 1
  RPM -> att, gam3, NA 
  RPM <-> RPM, var0, NA
  "
)

newds<-workds_NA4[1:134,FacStr_RPM]

#fitting the model 
fit1<-sem::sem(factormodel_RPM,data=newds) #data should contain only necessary variables.

pathDiagram(fit1,labels="both",style = "ram")
#semPaths(fit1,whatLabels = "est",rotation = 2)
#summary(fit1)

```

#Methodology

We add travel and demographic variables to each dimension and slowly build the model based on significance test. Other Notes: After completing the modeling of Satisfaction with demographics and travel variables I tried to build a full model that contains all the factor structures to start with and experiment with adding the demographic variables. However it is too difficult to proceed in that way because the reason for error was difficult to gauge. Therefore I will do whatever I did for satisfaction and then try to summarize a full model. 


#Rochester Public Market - Satisfaction 
The following section documents the experiments to find the structural model for satisfaction dimension of the RPM. We test for significance of each demographic variable with one sense of place dimension before moving to the other dimensions. Based on the results from the combination of tests a final model for RPPM- satisfaction will be presented. 

List of dimensions and the factor structure are already discussed earlier. Check Figure 1.  

## Demographic Variables  
###Satisfaction - AGE

The figure below (Figure 3) shows the only significant model for age in satisfaction structure of RPM. Trail and error method was used to identify the significant variable. 

```{r rpmsatage, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,sat_RPM]
newds<-cbind(newds,age_35to45)# age_le25,age_55to64,age_45to54,age_35to45,age_25to35,age_65to75)
newds<-newds[1:134,]

model.RPM.sat.age<-specifyModel("model_RPM_sat_age.R")  
#fitting the model 
fit.RPM.sat.age<-sem::sem(model.RPM.sat.age,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.sat.age,whatLabels = "est",rotation = 2)
summary(fit.RPM.sat.age)

```

###Satisfaction - Gender
Follow the same procedure as above but for gender. However gender was not a significant variable therefore they will not be included. 

```{r rpmsatgender, include=FALSE, echo=FALSE, eval=FALSE, fig.cap="SEM model for RPM with satisfaction and age between 35 to 45", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,sat_RPM]
newds<-cbind(newds,age_35to45,female)
newds<-newds[1:134,]

model.RPM.sat.gender<-specifyModel("model_RPM_sat_gender.R") 
#fitting the model 
fit.RPM.sat.gender<-sem::sem(model.RPM.sat.gender,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.sat.gender,whatLabels = "est",rotation = 2)
summary(fit.RPM.sat.gender)

```

###Satisfaction - How long did the visitor live in rochester
In this experiment all the variables were found insignificant **unfortunately**. 

```{r rpmsatyearsinROC, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,sat_RPM]
newds<-cbind(newds,age_35to45, years_DtoAyears)
newds<-newds[1:134,]

model.RPM.sat.yearsinROC<-specifyModel("model_RPM_sat_yearsinROC.R") 
#fitting the model 
fit.RPM.sat.yearsinROC<-sem::sem(model.RPM.sat.yearsinROC,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.sat.yearsinROC,whatLabels = "est",rotation = 2)
summary(fit.RPM.sat.yearsinROC)

```

###Satisfaction - Income
None of the income variables were significant. Although some of the income groups were close to significance with $z value ~= 1.4$. 

```{r rpmsatincome, include=FALSE, eval=FALSE,echo=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,sat_RPM]
newds<-cbind(newds,age_35to45,inc_le25k)
             #inc_75kto100k,inc_ge200k,inc_50kto75k,inc_25kto50k,inc_175kto200k,
            #inc_100kto125k,inc_125kto150k,inc_150kto175k, inc_DtoA) 

newds<-newds[1:134,]

model.RPM.sat.income<-specifyModel("model_RPM_sat_income.R") 
#fitting the model 
fit.RPM.sat.income<-sem::sem(model.RPM.sat.income,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.sat.income,whatLabels = "est",rotation = 2)
summary(fit.RPM.sat.income)

```

###Satisfaction - number of household members 
Notes: there seems to be an interactio nbetween *hhmem_1* and *hhmem_2*. When running the model seperately with *hhmem_1* we get a significant value for *hhmem_1*. When I run *hhmem_1* and*hhmem_2* together *hhmem_1* becomes insignificant, while *hhmem_2* is significant. when i run *hhmem_2* seperately, *hhmem_2* is significant. In addition to these two values *hhmem_5ormore* was also significant. When i ran a model with *hhmem_2 and hhmem_5* together *hhmem_5ormore* became insignificant. Therefore from this point forward variable *hhmem_2* will be included while the other two that were significant independently will be given further inspection later.  

```{r rpmsatnoHHmem, include=FALSE, eval=TRUE,echo=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,sat_RPM]
newds<-cbind(newds,age_35to45, hhmem_2)
             #hhmem_1, hhmem_2, hhmem_3, hhmem_4, hhmem_5ormore, hhmem_DtoA

newds<-newds[1:134,]

model.RPM.sat.noHHmem<-specifyModel(text = "
#Satisfaction Structure Model 
sat -> food, NA, 1
sat -> amn, pi2, NA
sat -> ent, pi3, NA
sat -> ppl, pi4, NA
sat -> mopark, pi5, NA 
sat -> bipark, pi6, NA
sat -> biwalk_access,pi7, NA
sat -> trnst_access, pi8, NA
sat <-> sat, var1, NA
food <-> food, err1, NA
amn <-> amn, err2, NA
ent <-> ent, err3, NA
ppl <-> ppl, err4, NA
mopark <-> mopark, err5, NA
bipark <-> bipark, err6, NA
biwalk_access <-> biwalk_access, err7, NA 
trnst_access <-> trnst_access, err8, NA

#age
age_35to45 -> sat, fi4, NA
age_35to45 <-> age_35to45, err22, NA

#no_hhmem
# hhmem_1 -> sat,fi27, NA
 hhmem_2 -> sat,fi28, NA 
# hhmem_3 -> sat,fi29, NA
# hhmem_4 -> sat,fi30, NA
# hhmem_5ormore -> sat,fi31, NA
# hhmem_DtoA -> sat,fi32, NA

# hhmem_1 <-> hhmem_1, err43, NA
 hhmem_2 <-> hhmem_2, err44, NA
# hhmem_3 <-> hhmem_3, err45, NA
# hhmem_4 <-> hhmem_4, err46, NA
# hhmem_5ormore <-> hhmem_5ormore, err47, NA
") 


#fitting the model 
fit.RPM.sat.noHHmem<-sem::sem(model.RPM.sat.noHHmem,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.sat.noHHmem,whatLabels = "est",rotation = 2)
summary(fit.RPM.sat.noHHmem)

```


###Satisfaction - number of household members employed full time employed 
In this experiment people with 1 fulltime employed household member seemed to be a signifcant indicator of satisfaction. 

```{r rpmsatempft, include=FALSE, eval=TRUE, echo=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,sat_RPM]
newds<-cbind(newds,age_35to45,hhmem_2, emp_ft_1)
             #emp_ft_0,emp_ft_1, emp_ft_2, emp_ft_3, emp_ft_4, emp_ft_5ormore, emp_ft_DtoA

newds<-newds[1:134,]

model.RPM.sat.empft<-specifyModel(text = "#Satisfaction Structure Model 
sat -> food, NA, 1
sat -> amn, pi2, NA
sat -> ent, pi3, NA
sat -> ppl, pi4, NA
sat -> mopark, pi5, NA 
sat -> bipark, pi6, NA
sat -> biwalk_access,pi7, NA
sat -> trnst_access, pi8, NA
sat <-> sat, var1, NA
food <-> food, err1, NA
amn <-> amn, err2, NA
ent <-> ent, err3, NA
ppl <-> ppl, err4, NA
mopark <-> mopark, err5, NA
bipark <-> bipark, err6, NA
biwalk_access <-> biwalk_access, err7, NA 
trnst_access <-> trnst_access, err8, NA

#age
age_35to45 -> sat, fi4, NA
age_35to45 <-> age_35to45, err22, NA

#no_hhmem
hhmem_2 -> sat,fi28, NA 
hhmem_2 <-> hhmem_2, err44, NA

#emp_ft
# emp_ft_0 -> sat, fi33, NA # zvalue 1.4
 emp_ft_1 -> sat, fi34, NA
# emp_ft_0 <-> emp_ft_0, err49, NA
 emp_ft_1 <-> emp_ft_1, err50, NA

") 
#fitting the model 
fit.RPM.sat.empft<-sem::sem(model.RPM.sat.empft,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.sat.empft,whatLabels = "est",rotation = 2)
summary(fit.RPM.sat.empft)
```

###Satisfaction - number of children in household  
In this experiment no significant variables were found. 

```{r rpmsatchild, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,sat_RPM]
newds<-cbind(newds,age_35to45,hhmem_2, emp_ft_1, child_1)
             #child_0,child_1, child_2, child_3, child_4ormore, child_DtoA

newds<-newds[1:134,]

model.RPM.sat.child<-specifyModel("model_RPM_sat_child.R") 
#fitting the model 
fit.RPM.sat.child<-sem::sem(model.RPM.sat.child,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.sat.child,whatLabels = "est",rotation = 2)
summary(fit.RPM.sat.child)

```

###Satisfaction - realtionship with household members  
In this experiment people who were living immedialtely with family were significant in explaining satisfaction. 

```{r rpmsatrelation, include=FALSE, eval=FALSE,echo=FALSE, fig.cap="Final Model for RPM Satisfaction and demographic variables", fig.height=7,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,sat_RPM]
newds<-cbind(newds,age_35to45,hhmem_2, emp_ft_1,rltnHHmem_family)
             #rltnHHmem_acquaintances,rltnHHmem_extfamily,rltnHHmem_family,
             #rltnHHmem_friends,rltnHHmem_alone

newds<-newds[1:134,]

model.RPM.sat.relation<-specifyModel(text="#Satisfaction Structure Model 
sat -> food, NA, 1
sat -> amn, pi2, NA
sat -> ent, pi3, NA
sat -> ppl, pi4, NA
sat -> mopark, pi5, NA 
sat -> bipark, pi6, NA
sat -> biwalk_access,pi7, NA
sat -> trnst_access, pi8, NA
sat <-> sat, var1, NA
food <-> food, err1, NA
amn <-> amn, err2, NA
ent <-> ent, err3, NA
ppl <-> ppl, err4, NA
mopark <-> mopark, err5, NA
bipark <-> bipark, err6, NA
biwalk_access <-> biwalk_access, err7, NA 
trnst_access <-> trnst_access, err8, NA

#Demographics
#age
age_35to45 -> sat, fi4, NA
age_35to45 <-> age_35to45, err22, NA
#no_hhmem
hhmem_2 -> sat,fi28, NA 
hhmem_2 <-> hhmem_2, err44, NA
#emp_ft
emp_ft_1 -> sat, fi34, NA
emp_ft_1 <-> emp_ft_1, err50, NA

#relation with HHMEM
# rltnHHmem_acquaintances -> sat, fi46, NA
# rltnHHmem_alone -> sat, fi47, NA
# rltnHHmem_extfamily -> sat, fi48, NA
 rltnHHmem_family -> sat, fi49, NA
# rltnHHmem_friends -> sat, fi50, NA

#rltnHHmem_acquaintances <-> rltnHHmem_acquaintances, err62, NA
# rltnHHmem_alone <-> rltnHHmem_alone, err63, NA
# rltnHHmem_extfamily <-> rltnHHmem_extfamily, err64, NA
 rltnHHmem_family <-> rltnHHmem_family, err65, NA
# rltnHHmem_friends <-> rltnHHmem_friends, err66, NA
") 
#fitting the model 
fit.RPM.sat.relation<-sem::sem(model.RPM.sat.relation,data=newds) #data should contain only necessary variables.

pathDiagram(fit.RPM.sat.relation,edge.labels = "both",style = "ram")
#semPaths(fit.RPM.sat.relation,whatLabels = "est",rotation = 2)
summary(fit.RPM.sat.relation)

```

## Travel Variables 
Now I am experimenting with the travel variables. Compared to demographics there are only few travel related variables viz., 

*vist - how often people visited a location.  
*mode - what mode did they use? 
*biwalk - have they ever biked or walked to the location
*no_vehicles - number of vehicles at their home.  
*no_drivers - number of drivers at their home. 
*no_bicylces - number of bicylces at home 
* several variables indicating with whom they traveled to the location on day of interview

Of all the *travel* related variables discussed above, few of them could be informed by SOP dimension. For e.g., *mode, visit, biwalk*. While they also can be informed by other variables such as distance from home, number of vehicles and drivers using a simple regression. To not complicate the modeling exercise I will currently perform test the significance of the the variables *mode, visit, biwalk*. Because satisfaction, as a latent variable is already being informed by numerous satisfaction responses these travel variables will not affect the existing satisfaction factor structure.  

###Satisfaction - Visit
Responders who visited RPM all the three days a week are satisfied. For all other visitors no significance was found. 

```{r rpmsatvisit, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,sat_RPM]
newds<-cbind(newds,age_35to45,hhmem_2, emp_ft_1, rltnHHmem_family, threeormoretimesaweek)
             #everyday, #onceamonth, #onceaweek,# onceinthreeweeks, # onceintwoweeks, 
             #threeormoretimesaweek, # twiceaweek, #leonceamonth

newds<-newds[1:134,]

model.RPM.sat.visit<-specifyModel("model_RPM_sat_visit.R") 
#fitting the model 
fit.RPM.sat.visit<-sem::sem(model.RPM.sat.visit,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.sat.visit,whatLabels = "est",rotation = 2)
summary(fit.RPM.sat.visit)

```

###Satisfaction - Mode
Public transit was the only significant variable. 
```{r rpmsatmode, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,sat_RPM]
newds<-cbind(newds,age_35to45,hhmem_2, emp_ft_1, rltnHHmem_family, threeormoretimesaweek, publictransit)
            
             
newds<-newds[1:134,]

model.RPM.sat.mode<-specifyModel("model_RPM_sat_mode.R") 
#fitting the model 
fit.RPM.sat.mode<-sem::sem(model.RPM.sat.mode,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.sat.mode,whatLabels = "est",rotation = 2)
summary(fit.RPM.sat.mode)

```

###Satisfaction - Cycle or Walk in Summer
Notes: The variables *biwalk.oncein3weeks and biwalk.threeormoretimesaweek* seems to be interacting. When modeled individually both are significant however when modeled together *biwalk.oncein3weeks* is significant. 


```{r rpmsatbiwalk, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,sat_RPM]
newds<-cbind(newds,age_35to45,hhmem_2, emp_ft_1, rltnHHmem_family, threeormoretimesaweek, publictransit,
             biwalk.threeormoreaweek, biwalk.onceweek)
             #biwalk.none, biwalk.twiceaweek, biwalk.threeormoreaweek, biwalk.oncein2weeks, 
             #biwalk.oncein3weeks, biwalk.onceweek, biwalk.lemonth, biwalk.oncemonth 
             
newds<-newds[1:134,]

model.RPM.sat.biwalk<-specifyModel("model_RPM_sat_biwalk.R") 
#fitting the model 
fit.RPM.sat.biwalk<-sem::sem(model.RPM.sat.biwalk,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.sat.biwalk,whatLabels = "est",rotation = 2)
summary(fit.RPM.sat.biwalk)

```


## Final Model for RPM. Relationship between Satisfaction, travel and demographic variables


The final modEL structure is show below as Figure below. The summary statistics also provided. 
![Final Model RPM Relationship between Satisfaction, travel and demographic variables](Final_RPM_Sat_Demog_Travel)

```{r rpmsatfinal, include=TRUE, eval=TRUE,echo=FALSE, fig.cap="Final Model for RPM relation satisfaction to demographics and travel", fig.height=7,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,sat_RPM]
newds<-cbind(newds,age_35to45,hhmem_2, emp_ft_1, rltnHHmem_family, threeormoretimesaweek, publictransit,
             biwalk.threeormoreaweek, biwalk.onceweek)
RPM.sat.vars<-c("age_35to45","hhmem_2", "emp_ft_1", "rltnHHmem_family", "threeormoretimesaweek", "publictransit","biwalk.threeormoreaweek", "biwalk.onceweek")             
newds<-newds[1:134,]

model.RPM.sat.biwalk<-specifyModel(text = "#Satisfaction Structure Model 
sat -> food, NA, 1
sat -> amn, pi2, NA
sat -> ent, pi3, NA
sat -> ppl, pi4, NA
sat -> mopark, pi5, NA 
sat -> bipark, pi6, NA
sat -> biwalk_access,pi7, NA
sat -> trnst_access, pi8, NA
sat <-> sat, var1, NA
food <-> food, err1, NA
amn <-> amn, err2, NA
ent <-> ent, err3, NA
ppl <-> ppl, err4, NA
mopark <-> mopark, err5, NA
bipark <-> bipark, err6, NA
biwalk_access <-> biwalk_access, err7, NA 
trnst_access <-> trnst_access, err8, NA

#Demographics
#age
age_35to45 -> sat, fi4, NA
age_35to45 <-> age_35to45, err22, NA
#no_hhmem
hhmem_2 -> sat,fi28, NA 
hhmem_2 <-> hhmem_2, err44, NA
#emp_ft
emp_ft_1 -> sat, fi34, NA
emp_ft_1 <-> emp_ft_1, err50, NA
#relation
rltnHHmem_family -> sat, fi49, NA
rltnHHmem_family <-> rltnHHmem_family, err65, NA

#travel
#visit
threeormoretimesaweek<-sat,ti6, NA
threeormoretimesaweek<->threeormoretimesaweek,err72, NA
#mode
publictransit<-sat,ti12, NA
publictransit<->publictransit,err78, NA

#biwalk
# biwalk.none<-sat, ti14, NA
# biwalk.lemonth<-sat, ti15, NA
# biwalk.oncemonth<-sat, ti16, NA
 biwalk.onceweek<-sat, ti17, NA
# biwalk.oncein3weeks<-sat, ti18, NA
# biwalk.oncein2weeks<-sat, ti19, NA
 biwalk.threeormoreaweek<-sat, ti20, NA
# biwalk.twiceaweek<-sat, ti21, NA
 
# biwalk.none<->biwalk.none, err80, NA
# biwalk.lemonth<->biwalk.lemonth, err81, NA
# biwalk.oncemonth<->biwalk.oncemonth, err82, NA
 biwalk.onceweek<->biwalk.onceweek, err83, NA
# biwalk.oncein3weeks<->biwalk.oncein3weeks, err84, NA
# biwalk.oncein2weeks<->biwalk.oncein2weeks, err85, NA
 biwalk.threeormoreaweek<->biwalk.threeormoreaweek, err86, NA
# biwalk.twiceaweek<->biwalk.twiceaweek, err87, NA
") 
#fitting the model 
fit.RPM.sat.biwalk<-sem::sem(model.RPM.sat.biwalk,data=newds) #data should contain only necessary variables.

pathDiagram(fit.RPM.sat.biwalk,edge.labels = "both",style = "ram")
#semPaths(fit.RPM.sat.biwalk,whatLabels = "est",rotation = 2)
summary(fit.RPM.sat.biwalk)

```






#Rochester Public Market - Attachment 
This section shows the final model for RPM attachment. 
Coding Notes: Always change the *sat* to *att* in the *model_RPM_att_XXX* file/ 

## Demographic Variables  
###Attachment - Age
Significant variables - *age_55to64, age_45to55*

```{r rpmattage, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,att_RPM]
newds<-cbind(newds,age_55to64,age_45to54)# age_le25,age_55to64,age_45to54,age_35to45,age_25to35,age_65to75)
newds<-newds[1:134,]

model.RPM.att.age<-specifyModel("model_RPM_att_age.R")  
#fitting the model 
fit.RPM.att.age<-sem::sem(model.RPM.att.age,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.att.age,whatLabels = "est",rotation = 2)
summary(fit.RPM.att.age)

```

###Attachment - Gender
Both variables were *close* to 90% significance therefore gender is ignored. 
```{r rpmattgender, include=FALSE, echo=FALSE, eval=FALSE, fig.cap="SEM model for RPM with satisfaction and age between 35 to 45", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,att_RPM]
newds<-cbind(newds,age_55to64,age_45to54)
newds<-newds[1:134,]

model.RPM.att.gender<-specifyModel("model_RPM_att_gender.R") 
#fitting the model 
fit.RPM.att.gender<-sem::sem(model.RPM.att.gender,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.att.gender,whatLabels = "est",rotation = 2)
summary(fit.RPM.att.gender)

```

###Attachment - How long did the visitor live in rochester
variables significant were - *notfromROC,*
```{r rpmattyearsinROC, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,att_RPM]
newds<-cbind(newds,age_55to64,age_45to54,notfromRoc,
             )

#years_1to5 , years_6to10, years_DtoAyears, notfromRoc, years_le1, years_ge10

newds<-newds[1:134,]

model.RPM.att.yearsinROC<-specifyModel("model_RPM_att_yearsinROC.R") 
#fitting the model 
fit.RPM.att.yearsinROC<-sem::sem(model.RPM.att.yearsinROC,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.att.yearsinROC,whatLabels = "est",rotation = 2)
summary(fit.RPM.att.yearsinROC)

```

###Attachment - Income
*Inc25kto50k* very close to significance. No other variables were significant. 

```{r rpmattincome, include=FALSE, eval=FALSE,echo=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,att_RPM]
newds<-cbind(newds,age_55to64,age_45to54,notfromRoc)
             #inc_75kto100k,inc_ge200k,inc_50kto75k,inc_25kto50k,inc_175kto200k,
            #inc_100kto125k,inc_125kto150k,inc_150kto175k, inc_DtoA,inc_le25k) 

newds<-newds[1:134,]

model.RPM.att.income<-specifyModel("model_RPM_att_income.R") 
#fitting the model 
fit.RPM.att.income<-sem::sem(model.RPM.att.income,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.att.income,whatLabels = "est",rotation = 2)
summary(fit.RPM.att.income)

```

###Attachment - Number of household members 
*hhmem_5ormore* was the only significant variable.  

```{r rpmattnoHHmem, include=FALSE, eval=FALSE,echo=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,att_RPM]
newds<-cbind(newds,age_55to64,age_45to54,notfromRoc,hhmem_5ormore)
             #hhmem_1, hhmem_2, hhmem_3, hhmem_4, hhmem_5ormore, hhmem_DtoA

newds<-newds[1:134,]

model.RPM.att.noHHmem<-specifyModel("model_RPM_att_noHHmem.R") 

#fitting the model 
fit.RPM.att.noHHmem<-sem::sem(model.RPM.att.noHHmem,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.att.noHHmem,whatLabels = "est",rotation = 2)
summary(fit.RPM.att.noHHmem)

```


###Attachment - Number of household members employed full time employed 
*emp_ft_3* is the only significant variable. 

```{r rpmattempft, include=FALSE, eval=FALSE, echo=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,att_RPM]
newds<-cbind(newds,age_55to64,age_45to54,notfromRoc,hhmem_5ormore,emp_ft_3)
             #emp_ft_0,emp_ft_1, emp_ft_2, emp_ft_3, emp_ft_4, emp_ft_5ormore, emp_ft_DtoA

newds<-newds[1:134,]

model.RPM.att.empft<-specifyModel("model_RPM_att_empft.R") 
#fitting the model 
fit.RPM.att.empft<-sem::sem(model.RPM.att.empft,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.att.empft,whatLabels = "est",rotation = 2)
summary(fit.RPM.att.empft)
```

###Attachment - Number of children in household  
*child_3* was significant. However when it was added *hhmem_5ormore* became insignificant. When a cross tabulation was performed between them it was identified that the two variables were corelated. Therefore I won;t be adding child_3 in the equation. 
```{r rpmattchild, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,att_RPM]
newds<-cbind(newds,age_55to64,age_45to54,notfromRoc,hhmem_5ormore,emp_ft_3,
             child_3)
             #child_0,child_1, child_2, child_3, child_4ormore, child_DtoA

newds<-newds[1:134,]

model.RPM.att.child<-specifyModel("model_RPM_att_child.R") 
#fitting the model 
fit.RPM.att.child<-sem::sem(model.RPM.att.child,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.att.child,whatLabels = "est",rotation = 2)
summary(fit.RPM.att.child)

```

###Attachment - Relationship with household members  
No variables were significant. Although I did get an unusual error when running variables for *acquaintances and alone* 

```{r rpmattrelation, include=FALSE, eval=FALSE,echo=FALSE, fig.cap="Final Model for RPM Satisfaction and demographic variables", fig.height=7,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,att_RPM]
newds<-cbind(newds,age_55to64,age_45to54,notfromRoc,hhmem_5ormore,emp_ft_3)
             #rltnHHmem_acquaintances,rltnHHmem_extfamily,rltnHHmem_family,
             #rltnHHmem_friends,rltnHHmem_alone

newds<-newds[1:134,]

model.RPM.att.relation<-specifyModel("model_RPM_att_relation.R") 
#fitting the model 
fit.RPM.att.relation<-sem::sem(model.RPM.att.relation,data=newds) #data should contain only necessary variables.

#pathDiagram(fit.RPM.att.relation,edge.labels = "both",style = "ram")
semPaths(fit.RPM.att.relation,whatLabels = "est",rotation = 2)
summary(fit.RPM.att.relation)

```

## Travel Variables 
Now I am experimenting with the travel variables. Compared to demographics there are only few travel related variables viz., 

*vist - how often people visited a location.  
*mode - what mode did they use? 
*biwalk - have they ever biked or walked to the location
*no_vehicles - number of vehicles at their home.  
*no_drivers - number of drivers at their home. 
*no_bicylces - number of bicylces at home 
* several variables indicating with whom they traveled to the location on day of interview

Of all the *travel* related variables discussed above, few of them could be informed by SOP dimension. For e.g., *mode, visit, biwalk*. While they also can be informed by other variables such as distance from home, number of vehicles and drivers using a simple regression. To not complicate the modeling exercise I will currently perform test the significance of the the variables *mode, visit, biwalk*. Because satisfaction, as a latent variable is already being informed by numerous satisfaction responses these travel variables will not affect the existing satisfaction factor structure.  

###Attachment - Visit
Significant variables: *once a week and less than once a month*
```{r rpmattvisit, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,att_RPM]
newds<-cbind(newds,age_55to64,age_45to54,notfromRoc,hhmem_5ormore,emp_ft_3,onceaweek,leonceamonth)
             #everyday, #onceamonth, #onceaweek,# onceinthreeweeks, # onceintwoweeks, 
             #threeormoretimesaweek, # twiceaweek, #leonceamonth

newds<-newds[1:134,]

model.RPM.att.visit<-specifyModel("model_RPM_att_visit.R") 
#fitting the model 
fit.RPM.att.visit<-sem::sem(model.RPM.att.visit,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.att.visit,whatLabels = "est",rotation = 2)
summary(fit.RPM.att.visit)

```

###Attachment - Mode
*bike* mode was a significant indicator for attachment. 

```{r rpmattmode, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,att_RPM]
newds<-cbind(newds,age_55to64,age_45to54,notfromRoc,hhmem_5ormore,emp_ft_3,onceaweek,leonceamonth,bike)
            #bike, carpool, publictransit, personalvehicle, walk
             
newds<-newds[1:134,]

model.RPM.att.mode<-specifyModel("model_RPM_att_mode.R") 
#fitting the model 
fit.RPM.att.mode<-sem::sem(model.RPM.att.mode,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.att.mode,whatLabels = "est",rotation = 2)
summary(fit.RPM.att.mode)

```

###Attachment - Cycle or Walk in Summer
Notes: Some interesting results here. *biwalk.none, threeormoreaweek, oncein3weeks* were significant while *biwalk.onceweek, lemonth and oncemonth* showed the following error. 
>Error in w_mat %*% p_deriv_mat %*% invMat : requires numeric/complex matrix/vector arguments. 

At this time I couldn't find the reason for the error, however as we consilidate the variables these can be looked again. 

```{r rpmattbiwalk, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,att_RPM]
newds<-cbind(newds,age_55to64,age_45to54,notfromRoc,hhmem_5ormore,emp_ft_3,onceaweek,leonceamonth,bike,
             biwalk.none,biwalk.threeormoreaweek,biwalk.oncein3weeks)
             #biwalk.none, biwalk.twiceaweek, biwalk.threeormoreaweek, biwalk.oncein2weeks, 
             #biwalk.oncein3weeks, biwalk.onceweek, biwalk.lemonth, biwalk.oncemonth 
             
newds<-newds[1:134,]

model.RPM.att.biwalk<-specifyModel("model_RPM_att_biwalk.R") 
#fitting the model 
fit.RPM.att.biwalk<-sem::sem(model.RPM.att.biwalk,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.att.biwalk,whatLabels = "est",rotation = 2)
summary(fit.RPM.att.biwalk)

```


## Final Model for RPM. Relationship between Attachment, travel and demographic variables


The final modEL structure is show below as Figure below. The summary statistics also provided. 
![Final Model RPM Relationship between Attachment, travel and demographic variables](Final_RPM_Att_Demog_Travel)

```{r rpmattfinal, include=TRUE, eval=TRUE,echo=FALSE, fig.cap="Final Model for RPM relation Attachment to demographics and travel", fig.height=7,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,att_RPM]
newds<-cbind(newds,age_55to64,age_45to54,notfromRoc,hhmem_5ormore,emp_ft_3,onceaweek,leonceamonth,bike,
             biwalk.none,biwalk.threeormoreaweek,biwalk.oncein3weeks)
             
RPM.att.vars<-c("age_55to64","age_45to54","notfromRoc","hhmem_5ormore","emp_ft_3","onceaweek","leonceamonth","bike","biwalk.none","biwalk.threeormoreaweek","biwalk.oncein3weeks")
newds<-newds[1:134,]

model.RPM.att.biwalk<-specifyModel(text = "#Factor Structure
##Attention Structure Model
att -> connect, NA, 1
att -> disapp, pi13, NA
att -> happy, pi14, NA
att <-> att, var4, NA
connect <-> connect, err15, NA
disapp <-> disapp, err16, NA
happy <-> happy, err17, NA

#Demographics
#age
age_45to54 -> att, fi6, NA
age_55to64 -> att, fi7, NA
age_45to54 <-> age_45to54, err23, NA
age_55to64 <-> age_55to64, err24, NA 
#yearsinROC
notfromRoc -> att, fi14, NA
notfromRoc <-> notfromRoc, err30, NA
#nohhmem
hhmem_5ormore -> att,fi31, NA
hhmem_5ormore <-> hhmem_5ormore, err47, NA
#empft
emp_ft_3 -> att, fi36, NA
emp_ft_3 <-> emp_ft_3, err52, NA

#Travel Variables
#vist
onceaweek<-att,ti3, NA
leonceamonth<-att,ti8, NA
onceaweek<->onceaweek,err69, NA
leonceamonth<->leonceamonth,err74, NA
#mode
bike<-att,ti9, NA
bike<->bike,err75, NA
#biwalk
biwalk.none<-att, ti14, NA
biwalk.oncein3weeks<-att, ti18, NA
biwalk.threeormoreaweek<-att, ti20, NA
biwalk.none<->biwalk.none, err80, NA
biwalk.oncein3weeks<->biwalk.oncein3weeks, err84, NA
biwalk.threeormoreaweek<->biwalk.threeormoreaweek, err86, NA
") 
#fitting the model 
fit.RPM.att.biwalk<-sem::sem(model.RPM.att.biwalk,data=newds) #data should contain only necessary variables.

pathDiagram(fit.RPM.att.biwalk,edge.labels = "both",style = "ram")
#semPaths(fit.RPM.sat.biwalk,whatLabels = "est",rotation = 2)
summary(fit.RPM.att.biwalk)

```




#Rochester Public Market - Aesthetics 
This section shows the final model for RPM aesthetics 
Coding Notes: Always change the *att* to *aes* in the *model_RPM_att_XXX* file.

## Demographic Variables  
###Aesthetics - Age
Significant variables - *age_45to55*

```{r rpmaesage, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,aes_RPM]
newds<-cbind(newds,age_45to54)
# age_le25,age_55to64,age_45to54,age_35to45,age_25to35,age_65to75, age_ge75)

newds<-newds[1:134,]

model.RPM.aes.age<-specifyModel("model_RPM_aes_age.R")  
#fitting the model 
fit.RPM.aes.age<-sem::sem(model.RPM.aes.age,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.aes.age,whatLabels = "est",rotation = 2)
summary(fit.RPM.aes.age)

```

###Aesthetics - Gender
*age_45to55* and *female* seems interacting however their correlation was $-0.13$. This issue needs to be solved. same issue with indicator *male*. Their corrrelation is $0.13$. Confused whether to add gender variable. for now I am not adding it. I think in this situation chi-squared values could be helpful. Chisquared value when using only age variable (0.38) is smaller than using gender variable (3.71). Therefore I reject the use of age for aesthetics. 
```{r rpmaesgender, include=FALSE, echo=FALSE, eval=FALSE, fig.cap="SEM model for RPM with satisfaction and age between 35 to 45", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,aes_RPM]
newds<-cbind(newds,female)
newds<-newds[1:134,]

model.RPM.aes.gender<-specifyModel("model_RPM_aes_gender.R") 
#fitting the model 
fit.RPM.aes.gender<-sem::sem(model.RPM.aes.gender,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.aes.gender,whatLabels = "est",rotation = 2)
summary(fit.RPM.aes.gender)

```

###Aesthetics - How long did the visitor live in rochester
None were significant. 
```{r rpmaesyearsinROC, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,aes_RPM]
newds<-cbind(newds,female,
             years_ge10)

#years_1to5 , years_6to10, years_DtoAyears, notfromRoc, years_le1, years_ge10

newds<-newds[1:134,]

model.RPM.aes.yearsinROC<-specifyModel("model_RPM_aes_yearsinROC.R") 
#fitting the model 
fit.RPM.aes.yearsinROC<-sem::sem(model.RPM.aes.yearsinROC,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.aes.yearsinROC,whatLabels = "est",rotation = 2)
summary(fit.RPM.aes.yearsinROC)

```

###Aesthetics - Income
Significant variables *inc_100kto125k,inc_125kto150k*
```{r rpmaesincome, include=FALSE, eval=FALSE,echo=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,aes_RPM]
newds<-cbind(newds,female,inc_100kto125k,inc_125kto150k)
             #inc_75kto100k,inc_ge200k,inc_50kto75k,inc_25kto50k,inc_175kto200k,
            #inc_100kto125k,inc_125kto150k,inc_150kto175k, inc_DtoA,inc_le25k) 

newds<-newds[1:134,]

model.RPM.aes.income<-specifyModel("model_RPM_aes_income.R") 
#fitting the model 
fit.RPM.aes.income<-sem::sem(model.RPM.aes.income,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.aes.income,whatLabels = "est",rotation = 2)
summary(fit.RPM.aes.income)

```

###Aesthetics - Number of household members 
No variables were significant. Although there were some errors of hhmem_5ormore which i couldn't solve it. 
```{r rpmaesnoHHmem, include=FALSE, eval=FALSE,echo=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,aes_RPM]
newds<-cbind(newds,female,inc_100kto125k,inc_125kto150k,
             hhmem_DtoA)
             #hhmem_1, hhmem_2, hhmem_3, hhmem_4, hhmem_5ormore, hhmem_DtoA

newds<-newds[1:134,]

model.RPM.aes.noHHmem<-specifyModel("model_RPM_aes_noHHmem.R") 

#fitting the model 
fit.RPM.aes.noHHmem<-sem::sem(model.RPM.aes.noHHmem,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.aes.noHHmem,whatLabels = "est",rotation = 2)
summary(fit.RPM.aes.noHHmem)

```


###Aesthetics - Number of household members employed full time employed 
No variables were significant 
```{r rpmaesempft, include=FALSE, eval=FALSE, echo=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,aes_RPM]
newds<-cbind(newds,female,inc_100kto125k,inc_125kto150k,
             emp_ft_DtoA)
             #emp_ft_0,emp_ft_1, emp_ft_2, emp_ft_3, emp_ft_4, emp_ft_5ormore, emp_ft_DtoA

newds<-newds[1:134,]

model.RPM.aes.empft<-specifyModel("model_RPM_aes_empft.R") 
#fitting the model 
fit.RPM.aes.empft<-sem::sem(model.RPM.aes.empft,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.aes.empft,whatLabels = "est",rotation = 2)
summary(fit.RPM.aes.empft)
```

###Aesthetics - Number of children in household  
No variables were significant. 
```{r rpmaeschild, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,aes_RPM]
newds<-cbind(newds,female,inc_100kto125k,inc_125kto150k)
             #child_0,child_1, child_2, child_3, child_4ormore, child_DtoA

newds<-newds[1:134,]

model.RPM.aes.child<-specifyModel("model_RPM_aes_child.R") 
#fitting the model 
fit.RPM.aes.child<-sem::sem(model.RPM.aes.child,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.aes.child,whatLabels = "est",rotation = 2)
summary(fit.RPM.aes.child)

```

###Aesthetics - Relationship with household members  
Significant variable - rltnHHmem_acqaintances. Although only 5 people responsed in this category. Need to question the relationship.

```{r rpmaesrelation, include=FALSE, eval=FALSE,echo=FALSE, fig.cap="Final Model for RPM Satisfaction and demographic variables", fig.height=7,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,aes_RPM]
newds<-cbind(newds,female,inc_100kto125k,inc_125kto150k,rltnHHmem_acquaintances)
             #rltnHHmem_acquaintances,rltnHHmem_extfamily,rltnHHmem_family,
             #rltnHHmem_friends,rltnHHmem_alone

newds<-newds[1:134,]

model.RPM.aes.relation<-specifyModel("model_RPM_aes_relation.R") 
#fitting the model 
fit.RPM.aes.relation<-sem::sem(model.RPM.aes.relation,data=newds) #data should contain only necessary variables.

#pathDiagram(fit.RPM.aes.relation,edge.labels = "both",style = "ram")
semPaths(fit.RPM.aes.relation,whatLabels = "est",rotation = 2)
summary(fit.RPM.aes.relation)

```

## Travel Variables 
Now I am experimenting with the travel variables. Compared to demographics there are only few travel related variables viz., 

*vist - how often people visited a location.  
*mode - what mode did they use? 
*biwalk - have they ever biked or walked to the location
*no_vehicles - number of vehicles at their home.  
*no_drivers - number of drivers at their home. 
*no_bicylces - number of bicylces at home 
* several variables indicating with whom they traveled to the location on day of interview

Of all the *travel* related variables discussed above, few of them could be informed by SOP dimension. For e.g., *mode, visit, biwalk*. While they also can be informed by other variables such as distance from home, number of vehicles and drivers using a simple regression. To not complicate the modeling exercise I will currently perform test the significance of the the variables *mode, visit, biwalk*. Because satisfaction, as a latent variable is already being informed by numerous satisfaction responses these travel variables will not affect the existing satisfaction factor structure.  

###Aesthetics - Visit
Significant variables: *onceintwoweeks*
```{r rpmaesvisit, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,aes_RPM]
newds<-cbind(newds,female,inc_100kto125k,inc_125kto150k,rltnHHmem_acquaintances,onceintwoweeks)
             #everyday, #onceamonth, #onceaweek,# onceinthreeweeks, # onceintwoweeks, 
             #threeormoretimesaweek, # twiceaweek, #leonceamonth

newds<-newds[1:134,]

model.RPM.aes.visit<-specifyModel("model_RPM_aes_visit.R") 
#fitting the model 
fit.RPM.aes.visit<-sem::sem(model.RPM.aes.visit,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.aes.visit,whatLabels = "est",rotation = 2)
summary(fit.RPM.aes.visit)

```

###Aesthetics - Mode
No variables were significant. 
```{r rpmaesmode, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,aes_RPM]
newds<-cbind(newds,female,inc_100kto125k,inc_125kto150k,rltnHHmem_acquaintances,onceintwoweeks)
            #bike, carpool, publictransit, personalvehicle, walk
             
newds<-newds[1:134,]

model.RPM.aes.mode<-specifyModel("model_RPM_aes_mode.R") 
#fitting the model 
fit.RPM.aes.mode<-sem::sem(model.RPM.aes.mode,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.aes.mode,whatLabels = "est",rotation = 2)
summary(fit.RPM.aes.mode)

```

###Aesthetics - Cycle or Walk in Summer
Notes: Some interesting results here. 

```{r rpmaesbiwalk, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,aes_RPM]
newds<-cbind(newds,female,inc_100kto125k,inc_125kto150k,rltnHHmem_acquaintances,onceintwoweeks,biwalk.oncemonth)
             #biwalk.none, biwalk.twiceaweek, biwalk.threeormoreaweek, biwalk.oncein2weeks, 
             #biwalk.oncein3weeks, biwalk.onceweek, biwalk.lemonth, biwalk.oncemonth 
             
newds<-newds[1:134,]

model.RPM.aes.biwalk<-specifyModel("model_RPM_aes_biwalk.R") 
#fitting the model 
fit.RPM.aes.biwalk<-sem::sem(model.RPM.aes.biwalk,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.aes.biwalk,whatLabels = "est",rotation = 2)
summary(fit.RPM.aes.biwalk)

```


## Final Model for RPM. Relationship between Aesthetics, travel and demographic variables


The final modEL structure is show below as Figure below. The summary statistics also provided. 
![Final Model RPM Relationship between Aesthetics, travel and demographic variables](Final_RPM_Aes_Demog_Travel)

```{r rpmaesfinal, include=TRUE, eval=TRUE,echo=FALSE, fig.cap="Final Model for RPM relation Aesthetics to demographics and travel", fig.height=7,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,aes_RPM]
newds<-cbind(newds,female,inc_100kto125k,inc_125kto150k,rltnHHmem_acquaintances,onceintwoweeks,biwalk.oncemonth)
RPM.aes.vars<-c("female","inc_100kto125k","inc_125kto150k","rltnHHmem_acquaintances","onceintwoweeks","biwalk.oncemonth")             
newds<-newds[1:134,]

model.RPM.aes.biwalk<-specifyModel(text = "#Factor Structure
##Attention Structure Model
#Aesthetics Structure Model
aes -> beau, NA, 1
aes -> arch, pi11, NA
aes -> artistic, pi12, NA
aes <-> aes, var3, NA
beau <-> beau, err12, NA
arch <-> arch, err13, NA
artistic <-> artistic, err14, NA

#age
#age_45to54 -> aes, fi6, NA
#age_45to54 <-> age_45to54, err23, NA
#gender
female -> aes, fi1, NA
female <-> female, err19, NA

#income
inc_100kto125k->aes, fi18, NA
inc_125kto150k->aes, fi19, NA
inc_100kto125k<-> inc_100kto125k, err34, NA
inc_125kto150k<-> inc_125kto150k, err35, NA

#relation with HHMEM
rltnHHmem_acquaintances -> aes, fi46, NA
rltnHHmem_acquaintances <-> rltnHHmem_acquaintances, err62, NA

#travel variables 
#vist
onceintwoweeks<-aes,ti5, NA
onceintwoweeks<->onceintwoweeks,err71, NA


#biwalk
 biwalk.oncemonth<-aes, ti16, NA
 biwalk.oncemonth<->biwalk.oncemonth, err82, NA


") 
#fitting the model 
fit.RPM.aes.biwalk<-sem::sem(model.RPM.aes.biwalk,data=newds) #data should contain only necessary variables.

pathDiagram(fit.RPM.aes.biwalk,edge.labels = "both",style = "ram")
#semPaths(fit.RPM.sat.biwalk,whatLabels = "est",rotation = 2)
summary(fit.RPM.aes.biwalk)

```




#Rochester Public Market - Social 
This section shows the final model for RPM aesthetics 
Coding Notes: Always change the *att* to *soc* in the *model_RPM_att_XXX* file.

## Demographic Variables  
###Social - Age
Significant variables - None

```{r rpmsocage, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,soc_RPM]
newds<-cbind(newds,age_ge75)
# age_le25,age_55to64,age_45to54,age_35to45,age_25to35,age_65to75, age_ge75)

newds<-newds[1:134,]

model.RPM.soc.age<-specifyModel("model_RPM_soc_age.R")  
#fitting the model 
fit.RPM.soc.age<-sem::sem(model.RPM.soc.age,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.soc.age,whatLabels = "est",rotation = 2)
summary(fit.RPM.soc.age)

```

###Social - Gender
No variables were significant  
```{r rpmsocgender, include=FALSE, echo=FALSE, eval=FALSE, fig.cap="SEM model for RPM with satisfaction and age between 35 to 45", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,soc_RPM]
newds<-cbind(newds,male)
newds<-newds[1:134,]

model.RPM.soc.gender<-specifyModel("model_RPM_soc_gender.R") 
#fitting the model 
fit.RPM.soc.gender<-sem::sem(model.RPM.soc.gender,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.soc.gender,whatLabels = "est",rotation = 2)
summary(fit.RPM.soc.gender)

```

###Social - How long did the visitor live in rochester
None were significant. 
```{r rpmsocyearsinROC, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,soc_RPM]
newds<-cbind(newds,
             years_ge10)

#years_1to5 , years_6to10, years_DtoAyears, notfromRoc, years_le1, years_ge10

newds<-newds[1:134,]

model.RPM.soc.yearsinROC<-specifyModel("model_RPM_soc_yearsinROC.R") 
#fitting the model 
fit.RPM.soc.yearsinROC<-sem::sem(model.RPM.soc.yearsinROC,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.soc.yearsinROC,whatLabels = "est",rotation = 2)
summary(fit.RPM.soc.yearsinROC)

```

###Social - Income
variables *inc_50kto75k and inc_75kto100k* were close to significane. 
Significant variables *inc_100kto125k,inc_125kto150k*
```{r rpmsocincome, include=FALSE, eval=FALSE,echo=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,soc_RPM]
newds<-cbind(newds,inc_DtoA)
             #inc_75kto100k,inc_ge200k,inc_50kto75k,inc_25kto50k,inc_175kto200k,
            #inc_100kto125k,inc_125kto150k,inc_150kto175k, inc_DtoA,inc_le25k) 

newds<-newds[1:134,]

model.RPM.soc.income<-specifyModel("model_RPM_soc_income.R") 
#fitting the model 
fit.RPM.soc.income<-sem::sem(model.RPM.soc.income,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.soc.income,whatLabels = "est",rotation = 2)
summary(fit.RPM.soc.income)

```

###Social - Number of household members 
again...no variables were significant 
```{r rpmsocnoHHmem, include=FALSE, eval=FALSE,echo=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,soc_RPM]
newds<-cbind(newds,hhmem_5ormore)
             #hhmem_1, hhmem_2, hhmem_3, hhmem_4, hhmem_5ormore, hhmem_DtoA

newds<-newds[1:134,]

model.RPM.soc.noHHmem<-specifyModel("model_RPM_soc_noHHmem.R") 

#fitting the model 
fit.RPM.soc.noHHmem<-sem::sem(model.RPM.soc.noHHmem,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.soc.noHHmem,whatLabels = "est",rotation = 2)
summary(fit.RPM.soc.noHHmem)

```


###Social - Number of household members employed full time employed 
No variables were significant. SOMETHING IS PROBABLY WRONG. COULD IT BE INSIGNIFICENT VARIANCE OF *FRIENDLY* VARIABLE?
```{r rpmsocempft, include=FALSE, eval=FALSE, echo=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,soc_RPM]
newds<-cbind(newds,emp_ft_DtoA)
             #emp_ft_0,emp_ft_1, emp_ft_2, emp_ft_3, emp_ft_4, emp_ft_5ormore, emp_ft_DtoA

newds<-newds[1:134,]

model.RPM.soc.empft<-specifyModel("model_RPM_soc_empft.R") 
#fitting the model 
fit.RPM.soc.empft<-sem::sem(model.RPM.soc.empft,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.soc.empft,whatLabels = "est",rotation = 2)
summary(fit.RPM.soc.empft)
```

###Social - Number of children in household  
*child_3* was the first variable to significant however there was the following warning message $Warning message:In eval(expr, envir, enclos) : Negative parameter variances.
Model may be underidentified.$
```{r rpmsocchild, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,soc_RPM]
newds<-cbind(newds,child_DtoA)
             #child_0,child_1, child_2, child_3, child_4ormore, child_DtoA

newds<-newds[1:134,]

model.RPM.soc.child<-specifyModel("model_RPM_soc_child.R") 
#fitting the model 
fit.RPM.soc.child<-sem::sem(model.RPM.soc.child,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.soc.child,whatLabels = "est",rotation = 2)
summary(fit.RPM.soc.child)

```

###Social - Relationship with household members  
No significant variables.
```{r rpmsocrelation, include=FALSE, eval=FALSE,echo=FALSE, fig.cap="Final Model for RPM Satisfaction and demographic variables", fig.height=7,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,soc_RPM]
newds<-cbind(newds,rltnHHmem_friends)
             #rltnHHmem_acquaintances,rltnHHmem_alone, rltnHHmem_extfamily,rltnHHmem_family,
             #rltnHHmem_friends

newds<-newds[1:134,]

model.RPM.soc.relation<-specifyModel("model_RPM_soc_relation.R") 
#fitting the model 
fit.RPM.soc.relation<-sem::sem(model.RPM.soc.relation,data=newds) #data should contain only necessary variables.

#pathDiagram(fit.RPM.soc.relation,edge.labels = "both",style = "ram")
semPaths(fit.RPM.soc.relation,whatLabels = "est",rotation = 2)
summary(fit.RPM.soc.relation)

```

## Travel Variables 
Now I am experimenting with the travel variables. Compared to demographics there are only few travel related variables viz., 

*vist - how often people visited a location.  
*mode - what mode did they use? 
*biwalk - have they ever biked or walked to the location
*no_vehicles - number of vehicles at their home.  
*no_drivers - number of drivers at their home. 
*no_bicylces - number of bicylces at home 
* several variables indicating with whom they traveled to the location on day of interview

Of all the *travel* related variables discussed above, few of them could be informed by SOP dimension. For e.g., *mode, visit, biwalk*. While they also can be informed by other variables such as distance from home, number of vehicles and drivers using a simple regression. To not complicate the modeling exercise I will currently perform test the significance of the the variables *mode, visit, biwalk*. Because satisfaction, as a latent variable is already being informed by numerous satisfaction responses these travel variables will not affect the existing satisfaction factor structure.  

###Social - Visit
Significant variables: **None**
```{r rpmsocvisit, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,soc_RPM]
newds<-cbind(newds,leonceamonth)
             #everyday, #onceamonth, #onceaweek,# onceinthreeweeks, # onceintwoweeks, 
             #threeormoretimesaweek, # twiceaweek, #leonceamonth

newds<-newds[1:134,]

model.RPM.soc.visit<-specifyModel("model_RPM_soc_visit.R") 
#fitting the model 
fit.RPM.soc.visit<-sem::sem(model.RPM.soc.visit,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.soc.visit,whatLabels = "est",rotation = 2)
summary(fit.RPM.soc.visit)

```

###Social - Mode
*personalvehicle* very close to being significant at z value = 1.5. No other variables were significant. 
```{r rpmsocmode, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,soc_RPM]
newds<-cbind(newds,walk)
            #bike, carpool, publictransit, personalvehicle, walk
             
newds<-newds[1:134,]

model.RPM.soc.mode<-specifyModel("model_RPM_soc_mode.R") 
#fitting the model 
fit.RPM.soc.mode<-sem::sem(model.RPM.soc.mode,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.soc.mode,whatLabels = "est",rotation = 2)
summary(fit.RPM.soc.mode)

```

###Social - Cycle or Walk in Summer
only significant variable *biwalk.oncein2weeks*
```{r rpmsocbiwalk, include=FALSE, eval=FALSE, fig.cap="Simple SEM model based on satisfaction", fig.height=4,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,soc_RPM]
newds<-cbind(newds,biwalk.oncein2weeks)
             #biwalk.none, biwalk.lemonth, biwalk.oncemonth, biwalk.onceweek, biwalk.oncein2weeks, biwalk.oncein3weeks, biwalk.threeormoreaweek, biwalk.twiceaweek,  
             #   
             
newds<-newds[1:134,]

model.RPM.soc.biwalk<-specifyModel("model_RPM_soc_biwalk.R") 
#fitting the model 
fit.RPM.soc.biwalk<-sem::sem(model.RPM.soc.biwalk,data=newds) #data should contain only necessary variables.

#pathDiagram(fit,edge.labels = "both",style = "ram")
semPaths(fit.RPM.soc.biwalk,whatLabels = "est",rotation = 2)
summary(fit.RPM.soc.biwalk)

```


## Final Model for RPM. Relationship between Social, travel and demographic variables


The final modEL structure is show below as Figure below. The summary statistics also provided. 
![Final Model RPM Relationship between Social, travel and demographic variables](Final_RPM_Soc_Demog_Travel)

```{r rpmsocfinal, include=TRUE, eval=TRUE,echo=FALSE, fig.cap="Final Model for RPM relation Social to demographics and travel", fig.height=7,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,soc_RPM]
newds<-cbind(newds,biwalk.oncein2weeks)
             
newds<-newds[1:134,]

model.RPM.soc.biwalk<-specifyModel(text = "
#Social Structure Model
soc -> friendly, pi9, NA
soc -> family, pi10, NA
soc -> atmos, NA, 1
soc <-> soc, var2, NA
friendly <-> friendly, err9, NA
family <-> family, err10, NA
atmos <-> atmos, err11, NA

#travel
#biwalk
 biwalk.oncein2weeks<-soc, ti19, NA
 biwalk.oncein2weeks<->biwalk.oncein2weeks, err85, NA

") 
#fitting the model 
fit.RPM.soc.biwalk<-sem::sem(model.RPM.soc.biwalk,data=newds) #data should contain only necessary variables.

pathDiagram(fit.RPM.soc.biwalk,edge.labels = "both",style = "ram")
#semPaths(fit.RPM.sat.biwalk,whatLabels = "est",rotation = 2)
summary(fit.RPM.soc.biwalk)

RPM.soc.vars<-c("biwalk.oncein2weeks")

```




#Final Model for RPM
```{r rpmfinal, include=TRUE, eval=TRUE,echo=FALSE, fig.cap="Final Model for RPM", fig.height=7,fig.width=7}

#dataset for analysis 
newds<-workds_NA4[,c(att_RPM,aes_RPM,sat_RPM,soc_RPM)]
RPM.vars<-unique(c(RPM.soc.vars,RPM.aes.vars,RPM.att.vars,RPM.sat.vars))
newds<-cbind(newds,biwalk.oncein2weeks,female,inc_100kto125k,inc_125kto150k, rltnHHmem_acquaintances,onceintwoweeks, biwalk.oncemonth,  age_55to64,  age_45to54, notfromRoc, hhmem_5ormore, emp_ft_3, onceaweek, leonceamonth, bike, biwalk.none, biwalk.threeormoreaweek, biwalk.oncein3weeks, age_35to45, hhmem_2, emp_ft_1, rltnHHmem_family, threeormoretimesaweek, publictransit, biwalk.onceweek)


newds<-newds[1:134,]

model.RPM.final<-specifyModel("model_RPM_v1.R") 
#fitting the model 
fit.RPM.final<-sem::sem(model.RPM.final,data=newds) #data should contain only necessary variables.

png("RPM_final.png", width = 4, height = 7, units = 'in', res = 2000)
pathDiagram(fit.RPM.final,edge.labels = "both",style = "ram")
dev.off()

#semPaths(fit.RPM.sat.final,whatLabels = "est",rotation = 2)
summary(fit.RPM.final)
